\hypertarget{mkprog_8c}{\section{/home/yoon/git\-\_\-stuff/\-F\-A\-T\-E/src/fate/gl/mkprog.c File Reference}
\label{mkprog_8c}\index{/home/yoon/git\-\_\-stuff/\-F\-A\-T\-E/src/fate/gl/mkprog.\-c@{/home/yoon/git\-\_\-stuff/\-F\-A\-T\-E/src/fate/gl/mkprog.\-c}}
}


Efficiently creating and reusing Open\-G\-L programs.  


{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$stdint.\-h$>$}\\*
{\ttfamily \#include $<$stdbool.\-h$>$}\\*
{\ttfamily \#include $<$stdarg.\-h$>$}\\*
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$errno.\-h$>$}\\*
{\ttfamily \#include $<$fate/defs.\-h$>$}\\*
{\ttfamily \#include $<$fate/sys.\-h$>$}\\*
{\ttfamily \#include $<$fate/log.\-h$>$}\\*
{\ttfamily \#include $<$fate/fatal\-\_\-alloc.\-h$>$}\\*
{\ttfamily \#include $<$fate/file\-\_\-to\-\_\-string.\-h$>$}\\*
{\ttfamily \#include $<$fate/gl/defs.\-h$>$}\\*
{\ttfamily \#include $<$fate/gl/log.\-h$>$}\\*
{\ttfamily \#include $<$fate/gl/debug.\-h$>$}\\*
{\ttfamily \#include $<$fate/gl/mkprog.\-h$>$}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{mkprog_8c_structfgm__shaders__db__entry}{fgm\-\_\-shaders\-\_\-db\-\_\-entry}
\item 
struct \hyperlink{mkprog_8c_structfgm__shaders__db__struct}{fgm\-\_\-shaders\-\_\-db\-\_\-struct}
\item 
struct \hyperlink{mkprog_8c_structfgm__shader__type__entry}{fgm\-\_\-shader\-\_\-type\-\_\-entry}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
\hypertarget{mkprog_8c_a654ca1fa805c3f8fcab259aad0970d0d}{typedef struct \hyperlink{mkprog_8c_structfgm__shaders__db__entry}{fgm\-\_\-shaders\-\_\-db\-\_\-entry} {\bfseries fgm\-\_\-shaders\-\_\-db\-\_\-entry}}\label{mkprog_8c_a654ca1fa805c3f8fcab259aad0970d0d}

\item 
\hypertarget{mkprog_8c_a41491dd77b8c457bc9e4840571c11f43}{typedef struct \\*
\hyperlink{mkprog_8c_structfgm__shaders__db__struct}{fgm\-\_\-shaders\-\_\-db\-\_\-struct} {\bfseries fgm\-\_\-shaders\-\_\-db\-\_\-struct}}\label{mkprog_8c_a41491dd77b8c457bc9e4840571c11f43}

\item 
\hypertarget{mkprog_8c_ad101296d7775f5e9b673f280a1bb2959}{typedef struct \\*
\hyperlink{mkprog_8c_structfgm__shader__type__entry}{fgm\-\_\-shader\-\_\-type\-\_\-entry} {\bfseries fgm\-\_\-shader\-\_\-type\-\_\-entry}}\label{mkprog_8c_ad101296d7775f5e9b673f280a1bb2959}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{mkprog_8c_aef8f2b016358c56e33260f4309f7dc84}{G\-Luint {\bfseries fgm\-\_\-find\-\_\-or\-\_\-compile\-\_\-shader} (const char $\ast$path)}\label{mkprog_8c_aef8f2b016358c56e33260f4309f7dc84}

\item 
\hypertarget{mkprog_8c_a17a3d0a4ff225b884188e779ddc3d8b0}{void {\bfseries fate\-\_\-gl\-\_\-mkprog\-\_\-setup} (G\-Lint gl\-\_\-major, G\-Lint gl\-\_\-minor)}\label{mkprog_8c_a17a3d0a4ff225b884188e779ddc3d8b0}

\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
void($\ast$ \hyperlink{mkprog_8c_a25e9a0b1c7babdfa160ba7cc04876722}{fate\-\_\-gl\-\_\-mkprog\-\_\-cleanup} )(void)
\begin{DoxyCompactList}\small\item\em Clean-\/up function for \hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()}. \end{DoxyCompactList}\item 
int($\ast$ \hyperlink{mkprog_8c_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog} )(G\-Luint program, const char $\ast$save\-\_\-path,...)
\begin{DoxyCompactList}\small\item\em A helper function to create Open\-G\-L programs, in a 'make' fashion. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Efficiently creating and reusing Open\-G\-L programs. T\-O\-D\-O 

\subsection{Data Structure Documentation}
\index{fgm\-\_\-shaders\-\_\-db\-\_\-entry@{fgm\-\_\-shaders\-\_\-db\-\_\-entry}}\label{structfgm__shaders__db__entry}
\hypertarget{mkprog_8c_structfgm__shaders__db__entry}{}
\subsubsection{struct fgm\-\_\-shaders\-\_\-db\-\_\-entry}
\begin{DoxyFields}{Data Fields}
\hypertarget{mkprog_8c_a392682dc98a80edef174e4195c17e0ff}{uint64\-\_\-t}\label{mkprog_8c_a392682dc98a80edef174e4195c17e0ff}
&
hash&
\\
\hline

\hypertarget{mkprog_8c_ac70a89cac77396370620cf1024bc276f}{G\-Luint}\label{mkprog_8c_ac70a89cac77396370620cf1024bc276f}
&
shader\-\_\-id&
\\
\hline

\end{DoxyFields}
\index{fgm\-\_\-shaders\-\_\-db\-\_\-struct@{fgm\-\_\-shaders\-\_\-db\-\_\-struct}}\label{structfgm__shaders__db__struct}
\hypertarget{mkprog_8c_structfgm__shaders__db__struct}{}
\subsubsection{struct fgm\-\_\-shaders\-\_\-db\-\_\-struct}
\begin{DoxyFields}{Data Fields}
\hypertarget{mkprog_8c_ab19795d2c6db04b7818f1f7798ff23fd}{\hyperlink{mkprog_8c_structfgm__shaders__db__entry}{fgm\-\_\-shaders\-\_\-db\-\_\-entry} $\ast$}\label{mkprog_8c_ab19795d2c6db04b7818f1f7798ff23fd}
&
entries&
\\
\hline

\hypertarget{mkprog_8c_af9e49af50fc7463a863d5986fb6be79b}{unsigned}\label{mkprog_8c_af9e49af50fc7463a863d5986fb6be79b}
&
top&
\\
\hline

\end{DoxyFields}
\index{fgm\-\_\-shader\-\_\-type\-\_\-entry@{fgm\-\_\-shader\-\_\-type\-\_\-entry}}\label{structfgm__shader__type__entry}
\hypertarget{mkprog_8c_structfgm__shader__type__entry}{}
\subsubsection{struct fgm\-\_\-shader\-\_\-type\-\_\-entry}
\begin{DoxyFields}{Data Fields}
\hypertarget{mkprog_8c_aa791049c2d92639c7eba150285d314a2}{const char $\ast$}\label{mkprog_8c_aa791049c2d92639c7eba150285d314a2}
&
file\-\_\-extension&
\\
\hline

\hypertarget{mkprog_8c_a3e6b207b6c4b79ec613475438023ba60}{uint8\-\_\-t}\label{mkprog_8c_a3e6b207b6c4b79ec613475438023ba60}
&
min\-\_\-gl\-\_\-version&
\\
\hline

\hypertarget{mkprog_8c_a6ecd2bb69be49987dbc0791751d93be7}{G\-Lenum}\label{mkprog_8c_a6ecd2bb69be49987dbc0791751d93be7}
&
shader\-\_\-type&
\\
\hline

\end{DoxyFields}


\subsection{Variable Documentation}
\hypertarget{mkprog_8c_a7576369a0b1c9e15bb5c869adb53d986}{\index{mkprog.\-c@{mkprog.\-c}!fate\-\_\-gl\-\_\-mkprog@{fate\-\_\-gl\-\_\-mkprog}}
\index{fate\-\_\-gl\-\_\-mkprog@{fate\-\_\-gl\-\_\-mkprog}!mkprog.c@{mkprog.\-c}}
\subsubsection[{fate\-\_\-gl\-\_\-mkprog}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ fate\-\_\-gl\-\_\-mkprog)(G\-Luint program, const char $\ast$save\-\_\-path,...)}}\label{mkprog_8c_a7576369a0b1c9e15bb5c869adb53d986}


A helper function to create Open\-G\-L programs, in a 'make' fashion. 

\hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()} is intended as an efficient way to build Open\-G\-L programs at run-\/time, quite like the well-\/known 'make' utility. \hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()} builds a program binary file if at least one of the following conditions are met \-: -\/$>$ It doesn't exist; -\/$>$ It is incompatible; -\/$>$ One of the required shader file's last write time is greater. Otherwise, the existing program binary is used and no other operation takes place. Shader objects compiled in the process are stored in a table with their hashed filename as a key, and reused when needed for next calls to \hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()}. The program object is then linked.

It is the caller's responsibility to \-: -\/$>$ Create the program object via gl\-Create\-Program(); -\/$>$ Set any pre-\/linking parameters to the program object before calling \hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()}; -\/$>$ Delete the program object via gl\-Delete\-Program(); -\/$>$ Clean-\/up resources by calling \hyperlink{mkprog_8h_a25e9a0b1c7babdfa160ba7cc04876722}{fate\-\_\-gl\-\_\-mkprog\-\_\-cleanup()}.

Useful link \-: \href{https://www.opengl.org/wiki/Shader_Compilation}{\tt https\-://www.\-opengl.\-org/wiki/\-Shader\-\_\-\-Compilation}

\hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()}'s prototype must be considered as follows \-:

int fate\-\_\-gl\-\_\-mkprog(unsigned flags, G\-Luint program, const char $\ast$program\-\_\-binary\-\_\-save\-\_\-path, const char $\ast$shader\-\_\-path\-\_\-1, const char $\ast$shader\-\_\-path\-\_\-2, ... const char $\ast$shader\-\_\-path\-\_\-n, N\-U\-L\-L);

'program\-\_\-binary\-\_\-save\-\_\-path' indicates where to save the program's binary. If the file already exists, and no 'shader\-\_\-path' file outdates it, and its data is compatible with the current hardware/driver, then its data is imported into {\ttfamily program}, a message is issued, and no other operation takes place.

In case 'program\-\_\-binary\-\_\-save\-\_\-path' exists but is not compatible, a warning is issued and the process continues as if it didn't exist.

Any number of 'shader\-\_\-path' may be supplied, provided that the end of the list is indicated by a N\-U\-L\-L pointer. Any empty string is just ignored, which can be useful for automatic use.

For each 'shader\-\_\-path' \-: If its hash is already in the database, then the shader object associated with it is used and no compilation takes place. Otherwise, it is read into a newly created Open\-G\-L shader object, compiled, stored in the database and finally attached to {\ttfamily program}.

The shader's type is determined by the file extension, which can be one of \char`\"{}.\-vert\char`\"{}, \char`\"{}.\-frag\char`\"{}, \char`\"{}.\-geom\char`\"{}, \char`\"{}.\-tesc\char`\"{}, \char`\"{}.\-tese\char`\"{}, and \char`\"{}.\-comp\char`\"{}. If the shader's type could not be determined or the compilation has failed, a detailed error message is issued and \hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()}'s return value is set to 0.

{\ttfamily program} is then linked against its shaders, and then its shaders are detached from it.

\hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()} returns 0 in case of a fatal error, and 1 otherwise.

Basic usage \-: 
\begin{DoxyCode}
fate\_gl\_mkprog\_setup(gl\_major, gl\_minor);
GLuint program = glCreateProgram();
\textcolor{comment}{//Set any pre-linking parameters here.}
\hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\_gl\_mkprog}(program, \textcolor{stringliteral}{"cube.bin"}, \textcolor{stringliteral}{"cube.vert"}, \textcolor{stringliteral}{"cube.frag"}, NULL);
\hyperlink{mkprog_8h_a25e9a0b1c7babdfa160ba7cc04876722}{fate\_gl\_mkprog\_cleanup}();
glUseProgram(program);
...
glDeleteProgram(program);
\end{DoxyCode}
 \hypertarget{mkprog_8c_a25e9a0b1c7babdfa160ba7cc04876722}{\index{mkprog.\-c@{mkprog.\-c}!fate\-\_\-gl\-\_\-mkprog\-\_\-cleanup@{fate\-\_\-gl\-\_\-mkprog\-\_\-cleanup}}
\index{fate\-\_\-gl\-\_\-mkprog\-\_\-cleanup@{fate\-\_\-gl\-\_\-mkprog\-\_\-cleanup}!mkprog.c@{mkprog.\-c}}
\subsubsection[{fate\-\_\-gl\-\_\-mkprog\-\_\-cleanup}]{\setlength{\rightskip}{0pt plus 5cm}void($\ast$ fate\-\_\-gl\-\_\-mkprog\-\_\-cleanup)(void)}}\label{mkprog_8c_a25e9a0b1c7babdfa160ba7cc04876722}


Clean-\/up function for \hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()}. 

\hyperlink{mkprog_8h_a25e9a0b1c7babdfa160ba7cc04876722}{fate\-\_\-gl\-\_\-mkprog\-\_\-cleanup()} calls gl\-Delete\-Shader() on each shader object stored previously by \hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()}, and then empties the table. It is safe to call even if the table is already empty, and does not cause harm to future calls to \hyperlink{mkprog_8h_a7576369a0b1c9e15bb5c869adb53d986}{fate\-\_\-gl\-\_\-mkprog()} either. 